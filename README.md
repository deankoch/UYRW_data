
## r code

This repository hosts the R codebase for our data analysis and modelling workflows. Most of our scripts (\*.R)
include some [roxygen2-style commenting](https://rmarkdown.rstudio.com/articles_report_from_r_script.html) for
generating markdown report files (\*.knit.md), shared here
[to better document and organize](https://amstat.tandfonline.com/doi/abs/10.1080/00031305.2017.1399928)
our research.

### data

/R/get_data contains R scripts to fetch public datasets on the hydrology of UYR:

* [get_basins](https://github.com/deankoch/UYRW_data/blob/master/markdown/get_basins.md)
defines the study area and loads some hydrology info from
[NHDPlus](https://www.usgs.gov/core-science-systems/ngp/national-hydrography/access-national-hydrography-products)
* [get_weatherstations](https://github.com/deankoch/UYRW_data/blob/master/markdown/get_weatherstations.md)
finds climatic sensor station data at the
[GHCN](https://www.ncei.noaa.gov/metadata/geoportal/rest/metadata/item/gov.noaa.ncdc:C00861/html)
* [get_dem](https://github.com/deankoch/UYRW_data/blob/master/markdown/get_dem.md)
fetches the [USGS National Elevation Dataset](https://catalog.data.gov/dataset/national-elevation-dataset-ned-1-arc-second-downloadable-data-collection-national-geospatial-d)
* [get_streamgages](https://github.com/deankoch/UYRW_data/blob/master/markdown/get_streamgages.md)
finds historical daily values from [USGS Water Services](https://waterservices.usgs.gov/rest/Site-Service.html#outputDataTypeCd)
* [get_soils](https://github.com/deankoch/UYRW_data/blob/master/markdown/get_soils.md)
fetches SSURGO/STATSGO2 maps from the [National Cooperative Soil Survey](https://www.nrcs.usda.gov/wps/portal/nrcs/detail/soils/survey/geo/?cid=nrcs142p2_053627)
* [get_landuse](https://github.com/deankoch/UYRW_data/blob/master/markdown/get_landuse.md)
fetches data from [GAP/LANDFIRE](https://www.usgs.gov/core-science-systems/science-analytics-and-synthesis/gap/science/land-cover-data-overview)
* [get_meteo](https://github.com/deankoch/UYRW_data/blob/master/markdown/get_meteo.md)
fetches
[three](https://daymet.ornl.gov/)
[different](https://www.pacificclimate.org/data/daily-gridded-meteorological-datasets)
[gridded](https://ciresgroups.colorado.edu/livneh/data) meteorological reconstructions
* [get_snow](https://github.com/deankoch/UYRW_data/blob/master/markdown/get_snow.md)
finds snow data at [SNOTEL and partner networks](https://wcc.sc.egov.usda.gov)


### rswat

[rswat](https://github.com/deankoch/UYRW_data/blob/master/markdown/rswat.md) provides an easy-to-use R
interface to the configuration files in a SWAT+ project directory, helping to manage the large number
of parameters in this model. We may polish this code and release it as an R package at some point.


### analysis

The R/analysis directory (in development) is for building, fitting and analysing SWAT+ models in R.
This includes R wrappers for running the QSWAT+ workflow [in PyQGIS](https://gitlab.com/rob-yerc/swat)
and executing simulations, as well as helper functions for visualizing and analyzing the results. Using the
output from /R/get_data, we plan to fit SWAT+ models sequentially on small catchments in the UYRW. Check
back in the coming weeks as we add to this section to demonstrate the model building code:

* [make_subwatersheds](https://github.com/deankoch/UYRW_data/blob/master/markdown/make_subwatersheds.md)
partitions the UYRW area into subwatersheds with USGS gages at their outlets

* [helper_analysis](https://github.com/deankoch/UYRW_data/blob/master/markdown/helper_analysis.md)
utilities for creating and calibrating SWAT+ models in R

## about us

We are a team of mathematicians, statisticians, and ecologists, conducting a multi-year research project to develop an operational forecasting system for streamflow and water quality on the [Upper Yellowstone River](http://fwp.mt.gov/mtoutdoors/images/Storyimages/2017/UpperYellowstoneMap.jpg) (UYR) and its tributaries. Our system will be based on [SWAT+/gflow](https://www.mdpi.com/2306-5338/7/4/75), a hybrid of the [SWAT+](https://swat.tamu.edu/software/plus/) (Soil-Water-Assessment Tool) model for surface water dynamics, and gflow, physically-based groundwater flow module developed by Ryan Bailey to replace the current SWAT+ aquifer module. 

### funding

Our work is funded through a [MITACS](https://www.mitacs.ca/en/about) [Accelerate International](https://www.mitacs.ca/en/programs/accelerate/mitacs-accelerate-international) grant to Dean Koch, partnering the University of Alberta with R2CS LLC in Montana, and the [Yellowstone Ecological Research Center](https://www.yellowstoneresearch.org/yerc-lab). The project began on August 3, 2020.

## gallery

R is a powerful data-retrieval, GIS, and visualization tool. These figures are generated by the scripts in our repo using the [`tmap`](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html) package:

<img src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/uyrw_flowlines.png" width="45%"></img> <img src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/uyrw_basins.png" width="45%"></img> <img 
src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/weatherstation_sites.png" width="45%"></img> <img src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/streamgage_sites.png" width="45%"> <img
src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/soils.png" width="45%"> <img
src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/landuse.png" width="45%"> <img
src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/swat_landuse.png" width="45%"> <img
src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/dem.png" width="45%"> </img> <img src="https://raw.githubusercontent.com/deankoch/UYRW_data/master/graphics/meteo_gridded.png" width="100%"></img>
